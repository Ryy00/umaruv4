let e={};import a from"axios";import s from"fs";export const setup={name:"resend",version:"40.0.0",permission:"GroupAdmin",creator:"John Lester",description:"Resend a unsend message",category:"General",usages:["on","off"],mainScreenshot:["/media/resend/screenshot/main.jpg"],screenshot:["/media/resend/screenshot/main.jpg"],cooldown:5,isPrefix:!0};export const execEvent=async function({api:t,event:n,Users:d,umaru:r,kernel:m}){try{if(1==r.config.PerformanceMode&&0==r.config.PerformanceModeConfig.resend||"message_unsend"==n.type&&(n.senderID==t.getCurrentUserID()||n.senderID==n.threadID)||0==n.isGroup||r.data.threads[n.threadID]&&1!=r.data.threads[n.threadID].resend)return;let o={[n.senderID]:[]},g=[];const i=await d.getName(n.senderID);if("message_unsend"==n.type)if(e.data[n.messageID]&&0===e.data[n.messageID].attachments.length)t.sendMessage({body:i+" removed 1 message\ncontent: "+e.data[n.messageID].message,mentions:[{tag:i,id:n.senderID}]},n.threadID);else{if(e.data[n.messageID]&&"share"==e.data[n.messageID].attachments[0].type&&t.sendMessage({body:i+" removed 1 message\ncontent: "+e.data[n.messageID].message,mentions:[{tag:i,id:n.senderID}]},n.threadID),e.data[n.messageID]&&"photo"==e.data[n.messageID].attachments[0].type){let d;d=e.data[n.messageID]&&e.data[n.messageID].attachments.length>1?"photos":"photo";for(const t of e.data[n.messageID].attachments){let e=(await a.get(t.url,{responseType:"stream"})).data;await m.writeStream(r.sdcard+"/"+t.ID+".jpg",e),o[n.senderID].push(s.createReadStream(r.sdcard+"/"+t.ID+".jpg")),g.push(r.sdcard+"/"+t.ID+".jpg")}t.sendMessage({body:i+" just removed "+e.data[n.messageID].attachments.length+" "+d+"\ncontent: "+e.data[n.messageID].message,attachment:o[n.senderID],mentions:[{tag:i,id:n.senderID}]},n.threadID,(async()=>{for(const e of g)await s.promises.unlink(e)}))}if(e.data[n.messageID]&&"animated_image"==e.data[n.messageID].attachments[0].type){let d;d=e.data[n.messageID]&&e.data[n.messageID].attachments.length>1?"gif images":"gif image";for(const t of e.data[n.messageID].attachments){let e=(await a.get(t.url,{responseType:"stream"})).data;await m.writeStream(r.sdcard+"/"+t.ID+".gif",e),o[n.senderID].push(s.createReadStream(r.sdcard+"/"+t.ID+".gif")),g.push(r.sdcard+"/"+t.ID+".gif")}t.sendMessage({body:i+" just removed "+e.data[n.messageID].attachments.length+" "+d+"\ncontent: "+e.data[n.messageID].message,attachment:o[n.senderID],mentions:[{tag:i,id:n.senderID}]},n.threadID,(async()=>{for(const e of g)await s.promises.unlink(e)}))}if(e.data[n.messageID]&&"video"==e.data[n.messageID].attachments[0].type){for(const t of e.data[n.messageID].attachments){let e=(await a.get(t.url,{responseType:"stream"})).data;await m.writeStream(r.sdcard+"/"+t.ID+".mp4",e),o[n.senderID].push(s.createReadStream(r.sdcard+"/"+t.ID+".mp4")),g.push(r.sdcard+"/"+t.ID+".mp4")}t.sendMessage({body:i+" just removed "+e.data[n.messageID].attachments.length+" video\ncontent: "+e.data[n.messageID].message,attachment:o[n.senderID],mentions:[{tag:i,id:n.senderID}]},n.threadID,(async()=>{for(const e of g)await s.promises.unlink(e)}))}if(e.data[n.messageID]&&"audio"==e.data[n.messageID].attachments[0].type){for(const t of e.data[n.messageID].attachments){let e=(await a.get(t.url,{responseType:"stream"})).data;await m.writeStream(r.sdcard+"/"+t.ID+".mp3",e),o[n.senderID].push(s.createReadStream(r.sdcard+"/"+t.ID+".mp3")),g.push(r.sdcard+"/"+t.ID+".mp3")}t.sendMessage({body:i+" just removed "+e.data[n.messageID].attachments.length+" audio\ncontent: "+e.data[n.messageID].message,attachment:o[n.senderID],mentions:[{tag:i,id:n.senderID}]},n.threadID,(async()=>{for(const e of g)await s.promises.unlink(e)}))}e.data[n.messageID]&&"sticker"==e.data[n.messageID].attachments[0].type&&t.sendMessage({body:i+" just removed "+e.data[n.messageID].attachments.length+" sticker\ncontent: "+e.data[n.messageID].attachments[0].caption,mentions:[{tag:i,id:n.senderID}]},n.threadID,(async()=>{t.sendMessage({sticker:e.data[n.messageID].attachments[0].stickerID},n.threadID)}))}else e.data||(e.data={}),e.data[n.messageID]||(e.data[n.messageID]={}),e.data[n.messageID].message||(e.data[n.messageID].message=n.body),e.data[n.messageID].attachments||(e.data[n.messageID].attachments=n.attachments)}catch{}};export const execCommand=async function({api:e,event:a,umaru:s,prefix:t,usage:n,args:d,context:r,translate:m}){if(0==a.isGroup)return e.sendMessage(await m("⚠️ This command is only allowed in group chat.",a,null,!0),a.threadID,a.messageID);let o=!(!d[0]||"on"!==d[0].toLowerCase())||(!d[0]||"off"!==d[0].toLowerCase())&&null;if(0===d.length||null===o)return n(this,t,a);let g=await m(!0===o?"enabled":"disabled",a,null,!0);return s.data.threads[a.threadID].resend=o,await s.save(),e.sendMessage(r+await m("✅ Resend successfully",a,null,!0)+" "+g,a.threadID,a.messageID)};