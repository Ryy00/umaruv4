const e=require("../utils"),t=require("npmlog");module.exports=function(r,n,o){return function(n,i,a){let s=function(){},u=function(){};const d=new Promise((function(e,t){s=e,u=t}));if(!a&&("Function"===e.getType(i)||"AsyncFunction"===e.getType(i)))throw{error:"please pass a threadID as a second argument."};if(a||(a=function(e){if(e)return u(e);s()}),"Number"!==e.getType(i)&&"String"!==e.getType(i))throw{error:"ThreadID should be of type Number or String and not "+e.getType(i)+"."};"Array"!==e.getType(n)&&(n=[n]);const c=e.generateOfflineThreadingID(),g={client:"mercury",action_type:"ma-type:log-message",author:"fbid:"+o.userID,thread_id:"",timestamp:Date.now(),timestamp_absolute:"Today",timestamp_relative:e.generateTimestampRelative(),timestamp_time_passed:"0",is_unread:!1,is_cleared:!1,is_forward:!1,is_filtered_content:!1,is_filtered_content_bh:!1,is_filtered_content_account:!1,is_spoof_warning:!1,source:"source:chat:web","source_tags[0]":"source:chat",log_message_type:"log:subscribe",status:"0",offline_threading_id:c,message_id:c,threading_id:e.generateThreadingID(o.clientID),manual_retry_cnt:"0",thread_fbid:i};for(let t=0;t<n.length;t++){if("Number"!==e.getType(n[t])&&"String"!==e.getType(n[t]))throw{error:"Elements of userID should be of type Number or String and not "+e.getType(n[t])+"."};g["log_message_data[added_participants]["+t+"]"]="fbid:"+n[t]}return r.post("https://www.facebook.com/messaging/send/",o.jar,g).then(e.parseAndCheckLogin(o,r)).then((function(e){if(!e)throw{error:"Add to group failed."};if(e.error)throw e;return a()})).catch((function(e){return t.error("addUserToGroup",e),a(e)})),d}};